<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DBHS Alumni Association тАФ Event Registration</title>

  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- QRCode generator -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

  <style>
    /* Elegant gradient background */
    body { background: radial-gradient(1200px 600px at 10% 10%, #0ea5e9 0%, transparent 40%),
                    radial-gradient(900px 500px at 90% 10%, #a855f7 0%, transparent 40%),
                    radial-gradient(1000px 700px at 50% 100%, #f59e0b 0%, #0b1021 60%); }
    .glass { backdrop-filter: blur(14px); background: rgba(255,255,255,0.08); }
    .card-sheen { position: relative; overflow: hidden; }
    .card-sheen:before { content: ""; position: absolute; inset: -200%; background:
      conic-gradient(from 210deg, rgba(255,255,255,.25), transparent 30%, transparent 70%, rgba(255,255,255,.25));
      animation: sheen 8s linear infinite; }
    @keyframes sheen { 100% { transform: rotate(1turn); } }
  </style>
</head>
<body class="min-h-screen text-white">
  <!-- Header -->
  <header class="max-w-6xl mx-auto px-4 pt-8 pb-4 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-12 h-12 rounded-2xl bg-white/10 grid place-items-center shadow-lg">
        <span class="text-2xl">ЁЯОУ</span>
      </div>
      <div>
        <h1 class="text-2xl md:text-3xl font-bold tracking-tight">Daulatpur Bohumukhi High School Alumni Association</h1>
        <p class="text-white/70 text-sm">Reunion тАв Networking тАв Lifelong Community</p>
      </div>
    </div>
    <a href="#registration" class="hidden md:inline-block px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 transition">Register Now</a>
  </header>

  <!-- Hero -->
  <section class="max-w-6xl mx-auto px-4 pt-2 pb-10">
    <div class="grid lg:grid-cols-2 gap-6 items-center">
      <div class="glass rounded-3xl p-6 md:p-10 shadow-2xl card-sheen">
        <h2 class="text-3xl md:text-4xl font-extrabold">Alumni Event 2025</h2>
        <p class="mt-3 text-white/80 leading-relaxed">ржкрзБрж░рзЛржирзЛ ржмржирзНржзрзБ, ржирждрзБржи ржирзЗржЯржУрзЯрж╛рж░рзНржХтАФрж╕ржмржЗ ржПржХ рж╕рж╛ржерзЗред рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи ржХрж░рзБржи, ржкрзЗржорзЗржирзНржЯ рж╕ржорзНржкржирзНржи ржХрж░рзБржи, ржЖрж░ рж╕рж╛ржерзЗ рж╕рж╛ржерзЗ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи ржЖржкржирж╛рж░ ржЗржнрзЗржирзНржЯ/ржорзЗржорзНржмрж╛рж░рж╢рж┐ржк ржХрж╛рж░рзНржбред</p>
        <ul class="mt-6 space-y-2 text-white/80">
          <li>тАв ржЕржирж▓рж╛ржЗржи рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи </li>
          <li>тАв ржкрзЗржорзЗржирзНржЯ рж╕ржлрж▓ рж╣рж▓рзЗ рждрзОржХрзНрж╖ржгрж╛рзО ржХрж╛рж░рзНржб ржбрж╛ржЙржирж▓рзЛржб</li>
          <li>тАв Event ID ржжрж┐рзЯрзЗ ржкрж░рзЗ ржпрзЗржХрзЛржирзЛ рж╕ржорзЯ ржХрж╛рж░рзНржб рж░рж┐-ржбрж╛ржЙржирж▓рзЛржб</li>
             <li>тАв <b>Date & Time</b> - 15 Dec 2025 тАФ 10:00 AM </li>
           <li>тАв<b>Venue</b>-DBHS Auditoriam </li>
          <li>тАв <b>Date & Time</b>-15 Dec 2025 тАФ 10:00 AM </li>

        </ul>
      </div>
      <div class="glass rounded-3xl p-6 md:p-10 shadow-2xl">
        <img src="https://ecloudbd.com/uploads/DHS/logo.png?v=1" alt="alumni" class="rounded-2xl w-full h-72 object-cover" />
        <p class="text-xs text-white/60 mt-2">Daulatpur Bohumukhi High School</p>
      </div>
    </div>
  </section>

  <!-- Registration -->
  <section id="registration" class="max-w-5xl mx-auto px-4 pb-20">
    <div class="glass rounded-3xl p-6 md:p-10 shadow-2xl">
      <h3 class="text-2xl md:text-3xl font-bold mb-6"> рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи ржлрж░рзНржо</h3>
          <p class="text-xs text-white/60 mt-2">рж░рзЗржЬрж┐рж╖рзНржЯрзНрж░рзЗрж╢ржи ржлрж░рзНржо ржкрзВрж░ржг ржХрж░рзЗ ржкрзЗржорзЗржирзНржЯ рж╕ржоржкржирзНржи ржХрж░рзЗ ржХрж╛рж░рзНржбржЯрж┐ рж╕ржВржЧрзНрж░рж╣ ржХрж░рзБржиред </p>

      <form id="registrationForm" class="grid md:grid-cols-2 gap-5">
        <!-- Left -->
        <div class="space-y-4">
          <div>
            <label class="block mb-1 text-white/80">ржкрзВрж░рзНржг ржирж╛ржо</label>
            <input class="w-full rounded-xl bg-white text-gray-900 px-4 py-3" name="name" placeholder="ржЖржкржирж╛рж░ ржирж╛ржо" required />
          </div>
          <div>
            <label class="block mb-1 text-white/80">ржЗржорзЗржЗрж▓ (ржРрж╢рзНржЪрж┐ржХ) </label>
            <input type="email" class="w-full rounded-xl bg-white text-gray-900 px-4 py-3" name="email" placeholder="you@example.com" />
          </div>
          <div>
            <label class="block mb-1 text-white/80">ржлрзЛржи</label>
            <input class="w-full rounded-xl bg-white text-gray-900 px-4 py-3" name="phone" placeholder="018XXXXXXXX" required />
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block mb-1 text-white/80">ржПрж╕ржПрж╕рж╕рж┐ ржмрзНржпрж╛ржЪ</label>
              <select class="w-full rounded-xl bg-white text-gray-900 px-4 py-3" name="batch" required>
                <option value="">ржмрзНржпрж╛ржЪ ржирж┐рж░рзНржмрж╛ржЪржи</option>
              </select>
            </div>
            <div>
              <label class="block mb-1 text-white/80">ржкрж╛рж╕рзЗрж░ рж╕ржи</label>
              <select class="w-full rounded-xl bg-white text-gray-900 px-4 py-3" name="passingYear" required>
                <option value="">ржмржЫрж░ ржирж┐рж░рзНржмрж╛ржЪржи</option>
              </select>
            </div>
          </div>
          <div>
            <label class="block mb-1 text-white/80">ржкрзНрж░рзЛржЧрзНрж░рж╛ржо</label>
            <select class="w-full rounded-xl bg-white text-gray-900 px-4 py-3" name="program" id="program" required>
              <option value="">ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржирж┐рж░рзНржмрж╛ржЪржи</option>
              <option value="Reunion" data-fee="1500">Reunion</option>
              <option value="Workshop" data-fee="1000">Workshop</option>
              <option value="Seminar" data-fee="800">Seminar</option>
            </select>
            <p class="text-sm mt-1 text-white/70">ржкрзНрж░рзЛржЧрзНрж░рж╛ржо рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзЗ ржлрж┐ ржкрж░рж┐рж╢рзЛржз ржХрж░рзБржи)ред</p>
          </div>
          <div>
            <label class="block mb-1 text-white/80">ржЬржиржкрзНрж░рждрж┐ ржлрж┐ (BDT)</label>
            <input type="number" class="w-full rounded-xl bg-white text-gray-900 px-4 py-3" name="fee" id="fee" placeholder="0" required />
          </div>
        </div>

        <!-- Right -->
        <div class="space-y-4">
          <div>
            <label class="block mb-2 text-white/80">ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржЫржмрж┐ (ржРржЪрзНржЫрж┐ржХ)</label>
            <div class="flex items-center gap-4">
              <div class="w-28 h-28 rounded-2xl bg-white/10 grid place-items-center overflow-hidden border border-white/20">
                <img id="photoPreview" class="w-full h-full object-cover hidden" alt="preview" />
                <span id="photoPlaceholder" class="text-3xl">ЁЯЦ╝я╕П</span>
              </div>
              <div class="flex-1">
                <input type="file" accept="image/*" id="photoInput" class="block w-full text-sm text-white/90 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-white/20 file:text-white hover:file:bg-white/30" />
                <p class="text-xs text-white/60 mt-1">JPG/PNG; 1MB ржПрж░ ржоржзрзНржпрзЗред</p>
              </div>
            </div>
          </div>

          <div class="glass rounded-2xl p-4 border border-white/10">
            <h4 class="font-semibold mb-2">ржкрзЗржорзЗржирзНржЯ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк </h4>
            <div class="text-sm space-y-1">
              <div class="flex justify-between"><span>ржкрзНрж░рзЛржЧрзНрж░рж╛ржо</span><span id="summaryProgram">тАФ</span></div>
              <div class="flex justify-between"><span>ржлрж┐ ржкрж░рж┐ржорж╛ржг </span><span><span id="summaryFee">0</span> BDT</span></div>
            </div>
          </div>

          <button type="button" id="payBtn" class="w-full py-3 rounded-xl bg-emerald-400 text-gray-900 font-extrabold hover:bg-emerald-300 transition">ржкрзЗржорзЗржирзНржЯ ржХрж░рзБржи</button>

          <div id="afterPayment" class="hidden space-y-3">
            <div class="glass rounded-2xl p-4 border border-emerald-300/30">
              <p class="text-sm">ржкрзЗржорзЗржирзНржЯ рж╕ржлрж▓ рж╣рзЯрзЗржЫрзЗ тЬЕ тАФ ржЖржкржирж╛рж░ <span class="font-semibold">Event ID</span>:</p>
              <div class="mt-2 flex gap-2">
                <input id="eventIdField" class="flex-1 rounded-xl bg-white text-black-900 px-4 py-3" readonly />
                <button id="copyIdBtn" type="button" class="px-4 rounded-xl bg-white/20 hover:bg-white/30">Copy</button>
              </div>
            </div>
            <button id="downloadCardBtn" type="button" class="w-full py-3 rounded-xl bg-amber-300 text-gray-900 font-extrabold hover:bg-amber-200">Membership/Event Card ржбрж╛ржЙржирж▓рзЛржб</button>
          </div>
        </div>
      </form>

      <!-- Re-download by Event ID -->
      <div class="mt-10 pt-8 border-t border-white/10">
        <h4 class="text-xl font-bold mb-3">Event ID ржжрж┐рзЯрзЗ ржХрж╛рж░рзНржб ржбрж╛ржЙржирж▓рзЛржб</h4>
        <div class="flex flex-col md:flex-row gap-3">
          <input id="lookupEventId" placeholder="ржЙржжрж╛рж╣рж░ржг: EV-20250906-4821" class="flex-1 rounded-xl bg-white text-gray-900 px-4 py-3" />
          <button id="lookupBtn" class="px-5 py-3 rounded-xl bg-sky-400 text-gray-900 font-bold hover:bg-sky-300">ржбрж╛ржЙржирж▓рзЛржб</button>
        </div>
        <p class="text-xs text-white/60 mt-2">ржмрж┐ржГржжрзНрж░ржГ ржПржЗржЦрж╛ржирзЗ ржЖржЗржбрж┐ ржкрзНрж░ржзрж╛ржи ржХрж░рзЗ ржЗржнрзЗржирзНржЯ ржПржирзНржЯрзНрж░рж┐ ржХрж╛рж░рзНржб  ржбрж╛ржЙржирж▓рзЛржб ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред ред</p>
      </div>
    </div>
  </section>

  <!-- Payment Modal (Simulated) -->
  <div id="payModal" class="fixed inset-0 hidden items-center justify-center bg-black/70 p-4 z-50">
    <div class="bg-white text-gray-900 max-w-md w-full rounded-2xl p-6">
      <h4 class="text-xl font-bold">ржкрзЗржорзЗржирзНржЯ</h4>
      <p class="text-sm text-gray-600 mt-1"> ржкрзЗржорзЗржирзНржЯ ржЧрзЗржЯржУрзЯрзЗ (bKash/Nagad/SSLCommerz) ржорж╛ржзрзНржпржорзЗ ржлрж┐ ржкрж░рж┐рж╢рзЛржз ржХрж░рзБржи ред</p>
      <div class="mt-4 space-y-2 text-sm">
        <div class="flex justify-between"><span>ржкрзНрж░рзЛржЧрзНрж░рж╛ржо</span><span id="mProgram">тАФ</span></div>
        <div class="flex justify-between"><span>ржлрж┐</span><span><span id="mFee">0</span> BDT</span></div>
        <div class="flex justify-between"><span>ржкрзЗржорзЗржирзНржЯ ржорзЗржержб</span><span>ржмрж┐ржХрж╛рж╢ </span></div>
      </div>
      <div class="mt-6 flex gap-3">
        <button id="confirmPay" class="flex-1 py-2 rounded-xl bg-emerald-500 text-white font-bold">Pay Success</button>
        <button id="cancelPay" class="flex-1 py-2 rounded-xl bg-gray-200 font-bold">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Hidden canvas for QR generation -->
  <canvas id="qrCanvas" class="hidden"></canvas>

  <script>
    // ====== CONFIG ======
    // 1) Google Apps Script Web App URL (deploy as web app, anyone with link):
    const GOOGLE_SHEETS_WEB_APP_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec'; // <-- replace
    // 2) Fake toggle for saving to Google Sheet in this demo. Set true when you add your Script URL above.
    const ENABLE_SHEETS_SAVE = false;

    // ====== Helpers ======
    const $ = (sel) => document.querySelector(sel);
    const registrationForm = $('#registrationForm');
    const programSel = $('#program');
    const feeInput = $('#fee');
    const summaryProgram = $('#summaryProgram');
    const summaryFee = $('#summaryFee');

    const photoInput = $('#photoInput');
    const photoPreview = $('#photoPreview');
    const photoPlaceholder = $('#photoPlaceholder');

    const payBtn = $('#payBtn');
    const payModal = $('#payModal');
    const mProgram = $('#mProgram');
    const mFee = $('#mFee');
    const confirmPay = $('#confirmPay');
    const cancelPay = $('#cancelPay');

    const afterPayment = $('#afterPayment');
    const eventIdField = $('#eventIdField');
    const copyIdBtn = $('#copyIdBtn');
    const downloadCardBtn = $('#downloadCardBtn');

    const lookupEventId = $('#lookupEventId');
    const lookupBtn = $('#lookupBtn');

    const qrCanvas = $('#qrCanvas');

    // Populate Batch & Year options
    (function initOptions(){
      const batchSel = registrationForm.elements['batch'];
      const yearSel = registrationForm.elements['passingYear'];
      const currentYear = new Date().getFullYear();
      for (let y = 1990; y <= currentYear; y++) {
        const opt1 = document.createElement('option');
        opt1.value = y; opt1.textContent = y; batchSel.appendChild(opt1);
        const opt2 = document.createElement('option');
        opt2.value = y; opt2.textContent = y; yearSel.appendChild(opt2);
      }
    })();

    // Program -> auto fee
    programSel.addEventListener('change', () => {
      const fee = programSel.selectedOptions[0]?.dataset.fee || 0;
      if (fee) feeInput.value = fee;
      updateSummary();
    });
    feeInput.addEventListener('input', updateSummary);
    function updateSummary(){
      summaryProgram.textContent = programSel.value || 'тАФ';
      summaryFee.textContent = feeInput.value || '0';
    }

    // Photo preview
    photoInput.addEventListener('change', () => {
      const file = photoInput.files?.[0];
      if (!file) { photoPreview.src = ''; photoPreview.classList.add('hidden'); photoPlaceholder.classList.remove('hidden'); return; }
      if (file.size > 1024*1024) { alert('ржЫржмрж┐рж░ рж╕рж╛ржЗржЬ 1MB ржПрж░ ржоржзрзНржпрзЗ ржжрж┐ржи'); photoInput.value = ''; return; }
      const reader = new FileReader();
      reader.onload = (e) => {
        photoPreview.src = e.target.result; 
        photoPreview.classList.remove('hidden');
        photoPlaceholder.classList.add('hidden');
      };
      reader.readAsDataURL(file);
    });

    // Payment flow (simulate)
    payBtn.addEventListener('click', () => {
      if (!registrationForm.checkValidity()) { registrationForm.reportValidity(); return; }
      mProgram.textContent = programSel.value || 'тАФ';
      mFee.textContent = feeInput.value || '0';
      payModal.classList.remove('hidden');
      payModal.classList.add('flex');
    });
    cancelPay.addEventListener('click', () => {
      payModal.classList.add('hidden');
      payModal.classList.remove('flex');
    });

    confirmPay.addEventListener('click', async () => {
      // Simulate payment success
      payModal.classList.add('hidden');
      payModal.classList.remove('flex');

      // Collect form data
      const data = formToObject(registrationForm);
      data.eventId = generateEventId();
      data.paidAt = new Date().toISOString();
      // attach photo base64 if present
      data.photoDataURL = photoPreview?.src?.startsWith('data:') ? photoPreview.src : '';

      // Save locally (demo) for later lookup by Event ID
      localStorage.setItem('alumni_' + data.eventId, JSON.stringify(data));

      // Save to Google Sheets via Apps Script (if enabled)
      if (ENABLE_SHEETS_SAVE && GOOGLE_SHEETS_WEB_APP_URL.includes('https://script.google.com/')) {
        try {
          await fetch(GOOGLE_SHEETS_WEB_APP_URL, {
            method: 'POST',
            mode: 'no-cors', // Apps Script often needs no-cors for public endpoint
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
        } catch(e) { console.warn('Sheets save error:', e); }
      }

      // Show post-payment UI
      afterPayment.classList.remove('hidden');
      eventIdField.value = data.eventId;

      // Bind download current card
      downloadCardBtn.onclick = () => generateCardPDF(data);

      // Reset form basics (keep summary visible)
      registrationForm.reset();
      photoPreview.src = ''; photoPreview.classList.add('hidden'); photoPlaceholder.classList.remove('hidden');
      updateSummary();
      alert('ржкрзЗржорзЗржирзНржЯ рж╕ржлрж▓! ржЖржкржирж╛рж░ Event ID: ' + data.eventId);
    });

    copyIdBtn.addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(eventIdField.value); copyIdBtn.textContent = 'Copied'; setTimeout(()=> copyIdBtn.textContent='Copy',1200); } catch {}
    });

    // Lookup and download by Event ID (from localStorage or later your backend)
    lookupBtn.addEventListener('click', () => {
      const id = (lookupEventId.value || '').trim();
      if (!id) return alert('Event ID рж▓рж┐ржЦрзБржи');
      const raw = localStorage.getItem('alumni_' + id);
      if (!raw) return alert('Event ID ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ ');
      const data = JSON.parse(raw);
      generateCardPDF(data);
    });

    function formToObject(form){
      const obj = {};
      new FormData(form).forEach((v, k) => obj[k] = v);
      return obj;
    }

    function generateEventId(){
      const d = new Date();
      const pad = (n)=> String(n).padStart(2,'0');
      const date = `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}`;
      const rnd = Math.floor(1000 + Math.random()*9000);
      return `EV-${date}-${rnd}`;
    }

    async function generateCardPDF(data){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit:'pt', format:'credit-card' }); // ~ 153x243pt
      const W = doc.internal.pageSize.getWidth();
      const H = doc.internal.pageSize.getHeight();

      // Background
      doc.setFillColor(20,30,60); doc.rect(0,0,W,H,'F');
      // Accent
      doc.setFillColor(255,215,0); doc.rect(0,0,W,10,'F');

      // Title
      doc.setTextColor(255,255,255);
      doc.setFontSize(12);
      doc.text('Alumni Association', 16, 26);
      doc.setFontSize(9);
      doc.text(  Event Entry Card', 16, 40);

      // Photo (if any)
      if (data.photoDataURL) {
        try { doc.addImage(data.photoDataURL, 'JPEG', W-70, 16 54, 54); } catch {}
      }

      // Details
      doc.setFontSize(10);
      const y0 = 70; let y = y0;
      const line = (k,v)=>{ doc.text(`${k}: ${v||'-'}`, 16, y); y+=14; };
      line('Name', data.name);
      line('Batch', data.batch);
      line('Passing', data.passingYear);
      line('Program', data.program);
      line('Event ID', data.eventId);

      // QR Code (Event ID)
      const qr = new QRious({ value: data.eventId, size: 90, level: 'M' });
      const qrURL = qr.toDataURL('image/png');
      doc.addImage(qrURL, 'PNG', W-100, H-100, 84, 84);

      // Footer
      doc.setFontSize(8);
      doc.setTextColor(200,200,200);
      doc.text('Verify: present Event ID at gate', 16, H-14);

      doc.save(`${(data.name||'member').replace(/\s+/g,'_')}_card.pdf`);
    }

    // Initialize summary on load
    updateSummary();
  </script>

  
</body>
</html>
